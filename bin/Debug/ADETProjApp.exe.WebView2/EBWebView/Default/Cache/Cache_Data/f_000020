(this["webpackJsonppaymongo-test-sources"]=this["webpackJsonppaymongo-test-sources"]||[]).push([[0],{121:function(e,t,a){e.exports=a.p+"static/media/paymongo-green.97e4c087.png"},127:function(e,t,a){e.exports=a(224)},149:function(e,t,a){},157:function(e,t,a){},179:function(e,t,a){},180:function(e,t,a){},181:function(e,t,a){},182:function(e,t,a){},183:function(e,t,a){},223:function(e,t,a){},224:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),i=a(37),o=a.n(i),c=a(5);c.a.init({clientToken:"".concat("pub3ad4aacf2372cb31c3b9ca490967d174"),service:"".concat("test-sources-web"),env:"".concat("production"),version:"".concat(Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_CORE_API_URL:"https://api.paymongo.com",REACT_APP_CARDINAL_MAX_RETRIES:"2",REACT_APP_DD_SERVICE:"test-sources-web",REACT_APP_DD_CLIENT_TOKEN:"pub3ad4aacf2372cb31c3b9ca490967d174",REACT_APP_CARDINAL_JS_URL:"https://songbird.cardinalcommerce.com/edge/v1/songbird.js",REACT_APP_DD_ENV:"production",REACT_APP_CARDINAL_EXTENDED_TIMEOUT:"6000",REACT_APP_MPGS_JS_VERSION:"61",REACT_APP_DD_APPLICATION_ID:"e97ff9e0-89d3-4d22-b6f8-1c5a3e39ca82",REACT_APP_MPGS_JS_URL:"https://ap-gateway.mastercard.com/static/threeDS/1.3.0/three-ds.min.js",REACT_APP_MPGS_AUTH_PAYER_TIMEOUT:"2000",REACT_APP_MPGS_AUTH_PAYER_MAX_RETRIES:"5",REACT_APP_API_URL:"https://test-sources-api.paymongo.com",REACT_APP_MPGS_WHITELISTED_ORG:"org_73VXZR81XgXHyqGzpsS76GoY, org_9Lx4s5qXKUu73em1JhEtfQBC",REACT_APP_CARDINAL_TIMEOUT:"10000"}).REACT_APP_DD_VERSION),site:"datadoghq.com",forwardErrorsToLogs:!0,sampleRate:100}),a(124).a.init({applicationId:"".concat("e97ff9e0-89d3-4d22-b6f8-1c5a3e39ca82"),clientToken:"".concat("pub3ad4aacf2372cb31c3b9ca490967d174"),site:"datadoghq.com",service:"".concat("test-sources-web"),env:"".concat("production"),version:"".concat(Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_CORE_API_URL:"https://api.paymongo.com",REACT_APP_CARDINAL_MAX_RETRIES:"2",REACT_APP_DD_SERVICE:"test-sources-web",REACT_APP_DD_CLIENT_TOKEN:"pub3ad4aacf2372cb31c3b9ca490967d174",REACT_APP_CARDINAL_JS_URL:"https://songbird.cardinalcommerce.com/edge/v1/songbird.js",REACT_APP_DD_ENV:"production",REACT_APP_CARDINAL_EXTENDED_TIMEOUT:"6000",REACT_APP_MPGS_JS_VERSION:"61",REACT_APP_DD_APPLICATION_ID:"e97ff9e0-89d3-4d22-b6f8-1c5a3e39ca82",REACT_APP_MPGS_JS_URL:"https://ap-gateway.mastercard.com/static/threeDS/1.3.0/three-ds.min.js",REACT_APP_MPGS_AUTH_PAYER_TIMEOUT:"2000",REACT_APP_MPGS_AUTH_PAYER_MAX_RETRIES:"5",REACT_APP_API_URL:"https://test-sources-api.paymongo.com",REACT_APP_MPGS_WHITELISTED_ORG:"org_73VXZR81XgXHyqGzpsS76GoY, org_9Lx4s5qXKUu73em1JhEtfQBC",REACT_APP_CARDINAL_TIMEOUT:"10000"}).REACT_APP_DD_VERSION),sampleRate:100,trackInteractions:!0,allowedTracingOrigins:["".concat("https://test-sources-api.paymongo.com")]});var s=a(2),u=a(10),d=a(7),l=a(15),p=a.n(l),h=a(27),f=a(9),_=a(28),g=a.n(_),m=function(){function e(){var t=this;Object(d.a)(this,e),this.setPageLoading=function(e){t.pageLoading=e},this.charge=function(){var e=Object(h.a)(p.a.mark((function e(a){var r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.setAuthorizeLoading(!0),e.next=4,t.loadData();case 4:if(!["chargeable","pending"].includes(t.source.status)){e.next=19;break}return e.next=7,g.a.post("".concat("https://test-sources-api.paymongo.com","/sources/").concat(t.source.id,"/charge"),a);case 7:if(200!==(r=e.sent).status){e.next=12;break}t.setSource(r.data.data),e.next=14;break;case 12:return e.next=14,t.loadData();case 14:t.setAuthorizeLoading(!1),t.setPageLoading(!1),t.setRedirectUrl(t.source.successUrl),e.next=20;break;case 19:t.setRedirectUrl("");case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(0),t.setRedirectUrl("");case 25:case"end":return e.stop()}}),e,null,[[0,22]])})));return function(t){return e.apply(this,arguments)}}(),this.fail=function(){var e=Object(h.a)(p.a.mark((function e(a){var r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.setAuthorizeLoading(!0),e.next=4,t.loadData();case 4:if(!["chargeable","pending"].includes(t.source.status)){e.next=19;break}return e.next=7,g.a.post("".concat("https://test-sources-api.paymongo.com","/sources/").concat(t.source.id,"/fail"),a);case 7:if(200!==(r=e.sent).status){e.next=12;break}t.setSource(r.data.data),e.next=14;break;case 12:return e.next=14,t.loadData();case 14:t.setAuthorizeLoading(!1),t.setPageLoading(!1),t.setRedirectUrl(t.source.failedUrl),e.next=20;break;case 19:t.setRedirectUrl("");case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(0),t.setRedirectUrl("");case 25:case"end":return e.stop()}}),e,null,[[0,22]])})));return function(t){return e.apply(this,arguments)}}(),this.authenticatedPayer=!1,this.authorizeLoading=!1,this.failLoading=!1,this.livemode=null,this.pageLoadingText=null,this.pageLoading=!0,this.parameterId="<none>",this.redirectUrl=void 0,this.sourceType="",this.source={id:void 0,amount:100,cardDeviceDataCollection:{},currency:"PHP",organizationId:"",type:"",failedUrl:"",redirect:{},status:"",successUrl:"",threeDSecureStatus:""}}return Object(f.a)(e,[{key:"setAuthorizeLoading",value:function(e){this.authorizeLoading=e}},{key:"setFailLoading",value:function(e){this.failLoading=e}},{key:"setLivemode",value:function(e){this.livemode=e}},{key:"setPageLoadingText",value:function(e){this.pageLoadingText=e}},{key:"setParameterId",value:function(e){this.parameterId=e}},{key:"setRedirectUrl",value:function(e){this.redirectUrl=e}},{key:"setSource",value:function(e){var t=this,a=e;a.attributes=a.attributes||{},a.attributes.redirect=a.attributes.redirect||{};var r={id:a.id,amount:a.attributes.amount,currency:a.attributes.currency,organizationId:a.attributes.organization_id,status:a.attributes.status,type:a.attributes.type,failedUrl:a.attributes.redirect.failed,successUrl:a.attributes.redirect.success};["card","three_d_secure"].includes(a.attributes.type)&&(r.redirect=a.attributes.redirect,r.failedUrl=a.attributes.redirect.return_url,r.successUrl=a.attributes.redirect.return_url,"card"===a.attributes.type&&(r.cardDeviceDataCollection={accessToken:a.attributes.card_device_data_collection.access_token,providerId:a.attributes.card_device_data_collection.provider_id,url:a.attributes.card_device_data_collection.url},r.threeDSecureStatus=a.attributes.three_d_secure_status)),Object.keys(r).forEach((function(e){t.source[e]=r[e]}))}},{key:"setSourceType",value:function(e){this.sourceType=e}},{key:"loadData",value:function(){var e=Object(h.a)(p.a.mark((function e(){var t,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.a.get("".concat("https://test-sources-api.paymongo.com","/sources/").concat(this.parameterId));case 3:t=e.sent,a=t.data.data,this.setSource(a),this.setLivemode(a.attributes.livemode),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(0),this.setPageLoading(!1),this.setLivemode(!1),this.setSource({id:""});case 14:case"end":return e.stop()}}),e,this,[[0,9]])})));return function(){return e.apply(this,arguments)}}()},{key:"authenticatePayer",value:function(){var e=Object(h.a)(p.a.mark((function e(){var t,a,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.setAuthorizeLoading(!0),this.setPageLoadingText("We are almost done setting up. You may be redirected to your bank\u2019s authentication page."),e.next=5,g.a.post("".concat("https://test-sources-api.paymongo.com","/sources/").concat(this.source.id,"/authenticate_payer"));case 5:if(t=e.sent,a=t.data.data,r={auth_token_response:a.attributes.redirect.auth_token},200!==t.status){e.next=18;break}if(this.authenticatedPayer=!0,!a.attributes.redirect.provider_auth_url){e.next=14;break}this.setSource(a),e.next=16;break;case 14:return e.next=16,this.charge(r);case 16:e.next=20;break;case 18:return e.next=20,this.loadData();case 20:this.setPageLoadingText(null),this.setAuthorizeLoading(!1),this.setPageLoading(!1),e.next=28;break;case 25:e.prev=25,e.t0=e.catch(0),this.setRedirectUrl("");case 28:case"end":return e.stop()}}),e,this,[[0,25]])})));return function(){return e.apply(this,arguments)}}()},{key:"expire",value:function(){var e=Object(h.a)(p.a.mark((function e(){var t;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.setAuthorizeLoading(!0),e.next=4,this.loadData();case 4:if("pending"!==this.source.status){e.next=17;break}return e.next=7,g.a.post("".concat("https://test-sources-api.paymongo.com","/sources/").concat(this.source.id,"/expire"));case 7:if(200!==(t=e.sent).status){e.next=12;break}this.setSource(t.data.data),e.next=14;break;case 12:return e.next=14,this.loadData();case 14:this.setAuthorizeLoading(!1),e.next=18;break;case 17:this.setRedirectUrl("");case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(0),this.setRedirectUrl("");case 23:case"end":return e.stop()}}),e,this,[[0,20]])})));return function(){return e.apply(this,arguments)}}()},{key:"cancel",value:function(){var e=Object(h.a)(p.a.mark((function e(){var t;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.setAuthorizeLoading(!0),e.next=4,this.loadData();case 4:if("pending"!==this.source.status){e.next=18;break}return e.next=7,g.a.post("".concat("https://test-sources-api.paymongo.com","/sources/").concat(this.source.id,"/cancel"));case 7:if(200!==(t=e.sent).status){e.next=13;break}this.setSource(t.data.data),this.setRedirectUrl(this.source.failedUrl),e.next=15;break;case 13:return e.next=15,this.loadData();case 15:this.setAuthorizeLoading(!1),e.next=19;break;case 18:this.setRedirectUrl("");case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(0),this.setRedirectUrl("");case 24:case"end":return e.stop()}}),e,this,[[0,21]])})));return function(){return e.apply(this,arguments)}}()},{key:"redirectToFailed",value:function(){var e=Object(h.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.setAuthorizeLoading(!0),e.next=4,this.loadData();case 4:if("paymaya"!==this.source.type){e.next=7;break}return e.next=7,g.a.post("".concat("https://test-sources-api.paymongo.com","/sources/").concat(this.source.id,"/fail"));case 7:"pending"===this.source.status?this.setRedirectUrl(this.source.failedUrl):this.setRedirectUrl(""),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),this.setRedirectUrl("");case 13:case"end":return e.stop()}}),e,this,[[0,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"willPostMessageToWindow",get:function(){var e="paymongojs://three_d_secure/return_url",t=!1;return("consumed"===this.source.status&&this.source.successUrl===e||["cancelled","failed"].includes(this.source.status)&&this.source.failedUrl===e)&&(t=!0),t}},{key:"willRedirectToNewPage",get:function(){return void 0!==this.redirectUrl&&""!==this.redirectUrl&&"paymongojs://three_d_secure/return_url"!==this.redirectUrl}},{key:"formattedAmount",get:function(){return this.source.amount.toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}},{key:"processing",get:function(){return this.authorizeLoading||this.failLoading}}]),e}();Object(s.j)(m,{authorizeLoading:s.o,failLoading:s.o,livemode:s.o,pageLoadingText:s.o,pageLoading:s.o,parameterId:s.o,redirectUrl:s.o,source:s.o,sourceType:s.o,loadData:s.f,setAuthorizeLoading:s.f,setFailLoading:s.f,setLivemode:s.f,setPageLoadingText:s.f,setPageLoading:s.f,setParameterId:s.f,setRedirectUrl:s.f,setSource:s.f,setSourceType:s.f,formattedAmount:s.g,processing:s.g,willPostMessageToWindow:s.g,willRedirectToNewPage:s.g});var y=m,E=function(){function e(){Object(d.a)(this,e),this.parameterId="",this.loading=!1,this.threeDSecure={id:void 0,status:"",returnUrl:""},this.notified=!1}return Object(f.a)(e,[{key:"setNotified",value:function(e){this.notified=e}},{key:"setLoading",value:function(e){this.loading=e}},{key:"setParameterId",value:function(e){this.parameterId=e}},{key:"setThreeDSecure",value:function(e){this.threeDSecure.id=e.id,this.threeDSecure.status=e.status,this.threeDSecure.returnUrl=e.returnUrl}},{key:"loadData",value:function(){var e=Object(h.a)(p.a.mark((function e(){var t,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.setLoading(!0),this.setThreeDSecure({id:"",status:"",returnUrl:""}),e.next=5,g.a.get("".concat("https://test-sources-api.paymongo.com","/three_d_secures/").concat(this.parameterId));case 5:t=e.sent,a=t.data.data,this.setThreeDSecure({id:a.id,status:a.attributes.status,returnUrl:a.attributes.redirect.return_url}),this.setLoading(!1),e.next=13;break;case 11:e.prev=11,e.t0=e.catch(0);case 13:case"end":return e.stop()}}),e,this,[[0,11]])})));return function(){return e.apply(this,arguments)}}()}]),e}();Object(s.j)(E,{threeDSecure:s.o,loading:s.o,notified:s.o,setNotified:s.f,setThreeDSecure:s.f,setLoading:s.f,setParameterId:s.f});var v=E,P=a(13),b=a(12),A=a(122),T=a(11),R=(a(149),a(113)),S=a.n(R),D=(a(95),a(60)),C=(a(157),function(e){Object(P.a)(a,e);var t=Object(b.a)(a);function a(){return Object(d.a)(this,a),t.apply(this,arguments)}return Object(f.a)(a,[{key:"componentDidMount",value:function(){var e=this.props.store;window.location.search.substr(1).split("&").forEach((function(t){var a=t.split("=");"source"===a[0]&&e.setParameterId(a[1])})),e.loadData(),Object(u.b)(this,[Object(s.p)((function(){return e.threeDSecure.status}),(function(t){e.notified||("consumed"===t||"failed"===t?(e.setNotified(!0),"paymongojs://three_d_secure/return_url"===e.threeDSecure.returnUrl?window.top!==window.parent?window.parent.postMessage("3DS-authentication-complete","*"):window.top.postMessage("3DS-authentication-complete","*"):window.location.href=e.threeDSecure.returnUrl):"pending"!==t&&"chargeable"!==t||setTimeout((function(){e.loadData()}),2e3))}))])}},{key:"render",value:function(){var e=this.props.store,t="";return"consumed"===e.threeDSecure.status?t="Authentication Complete":"failed"===e.threeDSecure.status&&(t="Authentication failed or cancelled."),n.a.createElement("div",{className:"AuthenticationCompleteScreen"},e.loading||"pending"===e.threeDSecure.status||"chargeable"===e.threeDSecure.status?n.a.createElement("div",{className:"Container"},n.a.createElement(D.a,null),n.a.createElement("p",{style:{marginTop:"1rem"}},"Verifying 3D Secure Authentication")):n.a.createElement("div",{className:"Container"},n.a.createElement("p",{className:"Header"},t),n.a.createElement("p",null,"You may close this window.")))}}]),a}(r.Component)),w=Object(u.c)((function(e){return{store:e.store.threeDSecure}}))(Object(u.d)(C)),O=(a(179),function(e){Object(P.a)(a,e);var t=Object(b.a)(a);function a(){return Object(d.a)(this,a),t.apply(this,arguments)}return Object(f.a)(a,[{key:"render",value:function(){var e=this.props,t=e.spinning,a=e.text;return n.a.createElement("div",{className:"LoaderComponent"},n.a.createElement(D.a,{spinning:t}),!!a&&t&&n.a.createElement("p",null,a))}}]),a}(r.Component));O.defaultProps={spinning:!1,text:null};var L=O,k=(a(180),function(e){Object(P.a)(a,e);var t=Object(b.a)(a);function a(){return Object(d.a)(this,a),t.apply(this,arguments)}return Object(f.a)(a,[{key:"render",value:function(){var e=new URLSearchParams(window.location.search),t=e.get("url"),a=e.get("id");return t&&(window.top!==window.parent?t.includes("/payments_partners/authentication_callback")?(c.a.logger.info("Notify organization of complete payment",{data:{callback_type:"iframe top not same as parent",notification_type:"redirect to shopify return URL",redirect_url:t,source_id:a}}),window.parent.location.href=t):(c.a.logger.info("Notify organization of complete payment",{data:{callback_type:"iframe top not same as parent",notification_type:"redirect to return URL",redirect_url:t,source_id:a}}),window.self.location.href=t):(c.a.logger.info("Notify organization of complete payment",{data:{notification_type:"redirect to return URL",source_id:a,redirect_url:t}}),window.top.location.href=t)),n.a.createElement("div",{className:"MPGSRedirectScreen"},n.a.createElement("div",{className:"Container"},t?n.a.createElement(L,{spinning:!0}):n.a.createElement("p",{className:"Header"}," Redirect URL not found ")),n.a.createElement("div",null))}}]),a}(r.Component)),I=(a(181),a(61)),x=a.n(I),U=function e(t){var a=this;Object(d.a)(this,e),this.initialize=function(){var e,t=window.Cardinal,r=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_CORE_API_URL:"https://api.paymongo.com",REACT_APP_CARDINAL_MAX_RETRIES:"2",REACT_APP_DD_SERVICE:"test-sources-web",REACT_APP_DD_CLIENT_TOKEN:"pub3ad4aacf2372cb31c3b9ca490967d174",REACT_APP_CARDINAL_JS_URL:"https://songbird.cardinalcommerce.com/edge/v1/songbird.js",REACT_APP_DD_ENV:"production",REACT_APP_CARDINAL_EXTENDED_TIMEOUT:"6000",REACT_APP_MPGS_JS_VERSION:"61",REACT_APP_DD_APPLICATION_ID:"e97ff9e0-89d3-4d22-b6f8-1c5a3e39ca82",REACT_APP_MPGS_JS_URL:"https://ap-gateway.mastercard.com/static/threeDS/1.3.0/three-ds.min.js",REACT_APP_MPGS_AUTH_PAYER_TIMEOUT:"2000",REACT_APP_MPGS_AUTH_PAYER_MAX_RETRIES:"5",REACT_APP_API_URL:"https://test-sources-api.paymongo.com",REACT_APP_MPGS_WHITELISTED_ORG:"org_73VXZR81XgXHyqGzpsS76GoY, org_9Lx4s5qXKUu73em1JhEtfQBC",REACT_APP_CARDINAL_TIMEOUT:"10000"}).REACT_APP_CARDINAL_PAYMENT_FRAMEWORK||"inline",n=a.store,i=n.charge,o=n.fail,s=n.setPageLoading,u=n.source;c.a.logger.info("Cardinal config initialize",{data:{source_id:u.id}}),t.configure({extendedtimeout:"6000",maxRequestRetries:"2",payment:{framework:r,displayLoading:!0,displayExitButton:!0},timeout:"10000"}),t.setup("init",{jwt:u.redirect.auth_token}),t.on("payments.setupComplete",(function(){c.a.logger.info("Cardinal config setup complete",{data:{source_id:u.id}}),t.continue("cca",{AcsUrl:u.redirect.provider_auth_url,Payload:u.redirect.provider_auth_id},{OrderDetails:{TransactionId:u.redirect.provider_transaction_id,OrderNumber:u.redirect.reference_id}})})),t.on("ui.inline.setup",(function(t,a,r,n){c.a.logger.info("Cardinal 3DS page setup",{data:{source_id:u.id}});try{if(void 0===t||void 0===a)throw new Error("Unable to process request due to invalid arguments");switch(a.paymentType){case"CCA":switch(a.data.mode){case"static":e=document.getElementById("visible-wrapper");break;case"suppress":e=document.getElementById("hidden-wrapper");break;default:throw new Error("Unsupported inline mode found [".concat(a.data.mode,"]"))}break;default:throw new Error("Unsupported inline payment type found [".concat(a.paymentType,"]"))}e.innerHTML=t,r()}catch(i){c.a.logger.info("Cardinal 3DS page render error",{data:{error:i,source_id:u.id}}),n(i)}})),t.on("ui.render",(function(){c.a.logger.info("Cardinal 3DS page open",{data:{source_id:u.id}}),s(!1)})),t.on("payments.validated",(function(t,a){t.source_id=u.id,c.a.logger.info("Cardinal 3DS page close",{data:t}),e&&(e.innerHTML=""),s(!0);var r={auth_token_response:a,error_code:t.ErrorNumber,error_description:t.ErrorDescription};switch(t.ErrorNumber){case 0:i(r);break;default:o(r)}}))},this.store=t},j=(a(182),function(e){Object(P.a)(a,e);var t=Object(b.a)(a);function a(){return Object(d.a)(this,a),t.apply(this,arguments)}return Object(f.a)(a,[{key:"componentDidMount",value:function(){var e=this.props.store;if("card"===e.source.type&&e.source.redirect.provider_auth_url||"three_d_secure"===e.source.type)if(e.authenticatedPayer){e.setPageLoading(!0);var t=new U(e);x()("https://songbird.cardinalcommerce.com/edge/v1/songbird.js",t.initialize)}else e.fail()}},{key:"render",value:function(){var e=this.props.store,t=null;return["card","three_d_secure"].includes(e.source.type)||(t=n.a.createElement("p",{className:"SubHead"},"Source\xa0",n.a.createElement("span",null,e.source.id),"\xa0is not applicable for processing.")),n.a.createElement("div",{className:"live-payment-page"},t,n.a.createElement("div",{id:"visible-wrapper"}),n.a.createElement("div",{id:"hidden-wrapper"}))}}]),a}(r.Component)),N=Object(u.c)((function(e){return{store:e.store.source}}))(Object(u.d)(j)),M=function(e){Object(P.a)(a,e);var t=Object(b.a)(a);function a(){return Object(d.a)(this,a),t.apply(this,arguments)}return Object(f.a)(a,[{key:"componentDidMount",value:function(){var e=this.props.store,t=e.source.id,a=document.querySelector("#cardinal_collection_form");try{a&&(e.setPageLoading(!0),e.setPageLoadingText("Kindly wait while we set up the authentication process for you."),c.a.logger.info("Cardinal Card Device Data Collection initiated",{data:{source_id:t}}),a.submit(),e.setPageLoadingText("Securely passing your device information to your bank for checking."))}catch(r){c.a.logger.info("Cardinal Card Device Data Collection failed",{data:{errors:r.message,source_id:t}}),e.fail({auth_token_response:e.source.redirect.auth_token,error_code:400,error_description:r.message}),e.setPageLoadingText(null)}window.addEventListener("message",(function(a){try{e.source.cardDeviceDataCollection.url.includes(a.origin)&&"pending"===e.source.status&&"card"===e.source.type&&(c.a.logger.info("Cardinal Authenticate Payer initiated",{data:{event_data:a.data,event_origin:a.origin,source_id:t}}),e.authenticatePayer())}catch(r){c.a.logger.info("Cardinal Authenticate Payer Failed",{data:{errors:r.message,source_id:t}}),e.setPageLoadingText(null)}}),!1)}},{key:"render",value:function(){var e=this.props.store;return n.a.createElement("div",null,n.a.createElement("iframe",{id:"cardinal_collection_iframe",name:"collectionIframe",height:"10",width:"10",style:{display:"none"}}),n.a.createElement("form",{id:"cardinal_collection_form",method:"POST",target:"collectionIframe",action:e.source.cardDeviceDataCollection.url},n.a.createElement("input",{id:"cardinal_collection_form_input",type:"hidden",name:"JWT",value:e.source.cardDeviceDataCollection.accessToken})))}}]),a}(r.Component),G=Object(u.c)((function(e){return{store:e.store.source}}))(Object(u.d)(M)),z=function e(){Object(d.a)(this,e),this.isConfigured=function(){return window.ThreeDS.isConfigured()},this.configure=function(e,t,a,r){window.ThreeDS.configure({callback:r,containerId:a,merchantId:e,sessionId:t,configuration:{wsVersion:"61"}})},this.initiateAuthentication=function(e,t,a){window.ThreeDS.initiateAuthentication(e,t,a,{sourceOfFunds:{type:"CARD"}})},this.authenticatePayer=function(e,t,a){window.ThreeDS.authenticatePayer(e,t,a,{})},this.onEvent=function(e,t){window.ThreeDS.onEvent(e,t)}},H=(a(183),function(e){Object(P.a)(a,e);var t=Object(b.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).contentRef=Object(r.createRef)(),n.isWhitelisted=n.isWhitelisted(),n.authPayerTimeout=n.getAuthPayerTimeout(),n}return Object(f.a)(a,[{key:"componentDidMount",value:function(){var e=this,t=this.props.sourceStore;"three_d_secure"===t.source.type&&(t.setPageLoading(!0),t.setPageLoadingText("Kindly wait while we set up the authentication process for you."),x()("https://ap-gateway.mastercard.com/static/threeDS/1.3.0/three-ds.min.js",(function(){e.client=new z,e.configureApi()})))}},{key:"configureApi",value:function(){var e=this,t=this.props.sourceStore;c.a.logger.info("MPGS config initialize",{data:{source_id:t.source.id}}),this.client.configure(t.source.redirect.card_mid,t.source.redirect.provider_auth_id,"checkout-3ds",(function(){e.client.isConfigured()?(e.initiateAuthentication(),e.client.onEvent("AFTER_AUTHENTICATE_PAYER",(function(e){"undefined"===typeof e?e={source_id:t.source.id}:e.source_id=t.source.id,c.a.logger.info("MPGS 3DS page close",{data:e})}))):(c.a.logger.info("MPGS config setup failure",{data:{source_id:t.source.id}}),t.fail({error_code:"FAILED_TO_CONFIGURE_API",error_description:"Failed to configure ThreeDsClient."}),t.setPageLoadingText(null))}))}},{key:"initiateAuthentication",value:function(){var e=this,t=this.props.sourceStore;c.a.logger.info("MPGS config setup complete",{data:{source_id:t.source.id}}),t.setPageLoadingText("Securely passing your device information to your bank for checking."),this.client.initiateAuthentication(t.source.redirect.reference_id,t.source.redirect.provider_transaction_id,(function(a){if(a.source_id=t.source.id,a&&a.error){var r=a.error;c.a.logger.info("MPGS 3DS initiateAuthentication failed",{data:a}),e.sourceFail(r,"initiateAuthentication"),t.setPageLoadingText(null)}else switch(c.a.logger.info("MPGS 3DS initiateAuthentication success",{data:a}),a.gatewayRecommendation){case"PROCEED":setTimeout((function(){e.authenticatePayer(1)}),e.authPayerTimeout);break;case"DO_NOT_PROCEED":c.a.logger.info("MPGS 3DS DO_NOT_PROCEED recommendation",{data:a}),t.fail({error_code:"DO_NOT_PROCEED",error_description:"Gateway recommendation is DO_NOT_PROCEED after initiating authentication."}),t.setPageLoadingText(null)}}))}},{key:"authenticatePayer",value:function(e){var t=this,a=this.props.sourceStore;c.a.logger.info("MPGS 3DS page setup - authenticate payer attempt : ".concat(e),{data:{source_id:a.source.id}}),a.setPageLoadingText("We are almost done setting up. You may be redirected to your bank\u2019s authentication page."),this.client.authenticatePayer(a.source.redirect.reference_id,a.source.redirect.provider_transaction_id,(function(r){if(r.source_id=a.source.id,r.error){var n=r.error;t.canRetryRequest(n,e)?setTimeout((function(){t.authenticatePayer(e+1)}),t.authPayerTimeout):(c.a.logger.info("MPGS 3DS page render error",{data:r}),t.sourceFail(n,"authenticatePayer"))}else{var i=document.createRange().createContextualFragment(r.htmlRedirectCode);c.a.logger.info("MPGS 3DS page open",{data:r}),t.contentRef.current.appendChild(i),t.contentRef.current.innerHTML&&(a.setPageLoading(!1),a.setPageLoadingText(null))}}))}},{key:"canRetryRequest",value:function(e,t){return"SERVER_BUSY"===e.cause&&this.isWhitelisted&&t+1<="5"}},{key:"createErrorDescription",value:function(e){var t=e.field?"".concat(e.field," - "):"";return t+=e.explanation?e.explanation:e.validationType}},{key:"getAuthPayerTimeout",value:function(){return this.isWhitelisted?parseInt("2000")||2e3:1e4}},{key:"isWhitelisted",value:function(){var e=this.props.sourceStore;return(null!=="org_73VXZR81XgXHyqGzpsS76GoY, org_9Lx4s5qXKUu73em1JhEtfQBC"?"org_73VXZR81XgXHyqGzpsS76GoY, org_9Lx4s5qXKUu73em1JhEtfQBC":"").split(",").map((function(e){return e.trim()})).filter((function(e){return!!e})).includes(e.source.organizationId)}},{key:"render",value:function(){var e=this.props.sourceStore;return n.a.createElement("div",{className:"live-payment-page"},"three_d_secure"!==e.source.type&&n.a.createElement("p",{className:"SubHead"},"Source\xa0",n.a.createElement("span",null,e.source.id),"\xa0is not applicable for processing."),n.a.createElement("div",{id:"checkout-3ds"}," "),n.a.createElement("div",{ref:this.contentRef}))}},{key:"sourceFail",value:function(e,t){var a=this.props.sourceStore,r=e.cause,n=this.createErrorDescription(e);e.cause||(r="MPGS_CLIENTJS_ERROR",n="MPGS 3DS "+t+" failed"),a.fail({error_code:r,error_description:n})}}]),a}(r.Component)),X=Object(u.c)((function(e){return{sourceStore:e.store.source}}))(Object(u.d)(H)),W=a(116),V=a.n(W),F=(a(185),a(125)),K=function(e){Object(P.a)(a,e);var t=Object(b.a)(a);function a(){return Object(d.a)(this,a),t.apply(this,arguments)}return Object(f.a)(a,[{key:"render",value:function(){var e=this.props,t=e.type,a=e.children,r=e.className,i=e.loading,o=e.disabled,c=e.onClick;return n.a.createElement(F.a,{type:t,loading:i,disabled:o,onClick:c,style:{paddingTop:".4rem",height:"auto",paddingBottom:".4rem"},className:r},a)}}]),a}(r.Component);K.defaultProps={type:"default",loading:!1,disabled:!1,className:"",onClick:null};var Y=K,B=function(e){Object(P.a)(a,e);var t=Object(b.a)(a);function a(){var e;Object(d.a)(this,a);for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))).authorizeAction=function(){e.props.store.charge()},e.redirectToFailedAction=function(){e.props.store.redirectToFailed()},e.expireAction=function(){e.props.store.expire()},e.failedAction=function(){e.props.store.fail()},e.cancelAction=function(){var t=e.props.store;"three_d_secure"==t.source.type?t.fail({error_code:"DECLINED",error_description:"Customer cancelled test payment."}):t.cancel()},e.grabPayAuthorizeAction=function(){var t=e.props.store;window.location.href="".concat("https://api.paymongo.com","/v1/grab_pay/webhook?state=test_state_").concat(t.source.id)},e}return Object(f.a)(a,[{key:"componentDidMount",value:function(){this.props.store.setPageLoading(!1)}},{key:"render",value:function(){var e=this.props.store,t=V()(e.source.currency),a=this.redirectToFailedAction,r=this.authorizeAction,i=!!e.source.redirect.return_url&&e.source.redirect.return_url.includes("/payments_partners/authentication_callback"),o="";return"atome"===e.source.type?o="Atome":"billease"===e.source.type?o="Billease":"gcash"===e.source.type?o="GCash":"paymaya"===e.source.type?o="Maya":"grab_pay"===e.source.type?(o="GrabPay",r=this.grabPayAuthorizeAction):"three_d_secure"===e.source.type&&(o="3DS",a=this.failedAction),n.a.createElement("div",{className:"test-payment-page"},n.a.createElement("h1",{className:"Head"},"".concat(o," Test Payment Page")),n.a.createElement("p",{className:"SubHead"},"This is a\xa0",n.a.createElement("span",null,"test payment")," of ".concat(t," ").concat(e.formattedAmount,".")),void 0!==e.source.id&&""!==e.source.id&&"pending"===e.source.status&&n.a.createElement("div",{className:"ActionButtons"},n.a.createElement(Y,{type:"primary",onClick:r,disabled:e.authorizeLoading||e.processing,loading:e.authorizeLoading},"Authorize Test Payment"),!["atome","billease"].includes(e.source.type)&&n.a.createElement(Y,{disabled:e.failLoading||e.processing,loading:e.failLoading,onClick:a},"Fail Test Payment"),"gcash"===e.source.type&&n.a.createElement(Y,{disabled:e.failLoading||e.processing,loading:e.failLoading,onClick:this.expireAction},"Expire Test Payment"),!i&&["grab_pay","three_d_secure","billease","atome"].includes(e.source.type)&&n.a.createElement(Y,{disabled:e.failLoading||e.processing,loading:e.failLoading,onClick:this.cancelAction},"Cancel Test Payment")))}}]),a}(r.Component),J=Object(u.c)((function(e){return{store:e.store.source}}))(Object(u.d)(B)),q=a(121),Q=a.n(q),Z=function(e){Object(P.a)(a,e);var t=Object(b.a)(a);function a(){return Object(d.a)(this,a),t.apply(this,arguments)}return Object(f.a)(a,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("message",(function(e){"3DS-authentication-complete"===e.data&&window.parent.postMessage("3DS-authentication-complete","*")}),!1),Object(u.b)(this,[Object(s.p)((function(){return e.props.store.parameterId}),(function(t){"<none>"!==t&&void 0!==t&&e.props.store.loadData()})),Object(s.p)((function(){return e.props.store.redirectUrl}),(function(t){var a=e.props.store;void 0!==t&&(""===t?(a.setPageLoading(!0),window.location.reload()):a.willRedirectToNewPage&&(c.a.logger.info("Notify organization of complete payment",{data:{notification_type:"redirect to return URL",redirect_url:t,source_id:a.source.id}}),a.setPageLoading(!0),window.location.href=t))})),Object(s.p)((function(){return e.props.store.source.status}),(function(t){var a=e.props.store;"pending"!==t&&a.setPageLoading(!1),["card","three_d_secure"].includes(a.source.type)&&a.willPostMessageToWindow&&(window.top!==window.parent?(c.a.logger.info("Notify organization of complete payment",{data:{callback_type:"iframe top not same as parent",notification_type:"frontend callback",source_id:a.source.id}}),window.parent.postMessage("3DS-authentication-complete","*")):(c.a.logger.info("Notify organization of complete payment",{data:{notification_type:"frontend callback",source_id:a.source.id}}),window.top.postMessage("3DS-authentication-complete","*"))),["atome","billease","paymaya"].includes(a.source.type)&&("consumed"===t?window.location.href=a.source.successUrl:"failed"===t&&(window.location.href=a.source.failedUrl))}))]);var t=this.props.store,a=window.location.search.substr(1).split("=");void 0!==a[1]&&t.setParameterId(a[1]),c.a.logger.info("Page Open",{data:{source_id:a[1]}})}},{key:"render",value:function(){var e=this.props.store,t=null,a=null;if(""===e.source.id)t=n.a.createElement("p",{className:"SubHead"},"Source\xa0",n.a.createElement("span",null,e.parameterId),"\xa0is an invalid source.");else if(["","chargeable","pending"].includes(e.source.status))if("pending"===e.source.status)if(!0===e.livemode)if("robinsons_bank"===e.source.redirect.provider)a=n.a.createElement(X,null);else switch(e.source.type){case"card":a=n.a.createElement(G,null);break;default:a=n.a.createElement(N,null)}else a=n.a.createElement(J,null);else"chargeable"===e.source.status&&"card"===e.source.type&&(a=n.a.createElement(N,null));else if(["card","three_d_secure"].includes(e.source.type)){var r=e.source,i="",o="",c=r.status;"card"===r.type&&(c=r.threeDSecureStatus||r.status),i="consumed"===c?"Authentication Complete.":"Authentication failed or cancelled.",o=e.willRedirectToNewPage?"You will be redirected in a few seconds...":"You may now close this window.",t=n.a.createElement("div",{className:"Message"},n.a.createElement("p",{className:"SubHead"},i),n.a.createElement("p",null,o))}else t=n.a.createElement(n.a.Fragment,null,n.a.createElement("p",{className:"SubHead"},"Source\xa0",n.a.createElement("span",null,e.source.id),"\xa0has\xa0",n.a.createElement("span",null,e.source.status),"\xa0status"),"consumed"===e.source.status&&"paymaya"===e.source.type&&n.a.createElement("p",{className:"Message"},"Authentication Done. You will be redirected in a few seconds."));return n.a.createElement("div",{className:"MainScreen"},n.a.createElement("div",{className:"Header"},!1===e.livemode&&n.a.createElement("img",{src:Q.a,alt:"Paymongo"})),n.a.createElement("div",{className:"Content"},n.a.createElement(L,{spinning:e.pageLoading,text:e.pageLoadingText}),t,a),n.a.createElement("div",null))}}]),a}(r.Component),$=Object(u.c)((function(e){return{store:e.store.source}}))(Object(u.d)(Z)),ee=function(e){Object(P.a)(a,e);var t=Object(b.a)(a);function a(){return Object(d.a)(this,a),t.apply(this,arguments)}return Object(f.a)(a,[{key:"render",value:function(){return n.a.createElement("div",{className:"App"},n.a.createElement(S.a,null,n.a.createElement("title",null,"PayMongo")),n.a.createElement(A.a,null,n.a.createElement(T.c,null,n.a.createElement(T.a,{path:"/mpgs_redirect"},n.a.createElement(k,null)),n.a.createElement(T.a,{path:"/authentication_complete"},n.a.createElement(w,null)),n.a.createElement(T.a,{path:"/"},n.a.createElement($,null)))))}}]),a}(r.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(223);Object(s.h)({enforceActions:"observed"});var te=new function e(){Object(d.a)(this,e),this.source=new y,this.threeDSecure=new v};o.a.render(n.a.createElement(u.a,{store:te},n.a.createElement(ee,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[127,1,2]]]);
//# sourceMappingURL=main.3a54885c.chunk.js.map